---
message: "Setting up Hephaestus"

classes:
  - 'profile::hapcat'
  - 'profile::postgres'
  - 'profile::r10k'

hapcat::database_loadtestdata: true
hapcatdbuser: 'hapcat'
hapcatdb: 'hapcat'
hapcat::database_url: "postgresql+psycopg2://%{lookup('hapcatdbuser')}:%{lookup('hapcatdbpw')}@localhost:5432/%{lookup('hapcatdb')}"

hapcat::use_http: false


nginx::nginx_servers:
  'hapcathttp':
    listen_port: 80
    use_default_location: false
    server_name:
      - 'hapcat.tenaisenma.com'
      - 'hephaestus.tenaisenma.com'

    locations:
      '/':
        include:
          - 'uwsgi_params'
        uwsgi: 'unix:///run/hapcat.socket'
  'hapcatalt':
    listen_port: 8080
    server_name:
      - 'hapcat.tenaisenma.com'
      - 'hephaestus.tenaisenma.com'
    rewrite_rules:
      - '^/(.*)$ http://hapcat.tenaisenma.com/$1 permanent'
